<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vestriaa</title>
</head>
<body>
    <h1>Welcome to Vestriaa</h1>

    <script>
        // Function to decode Base64 string from URL
        function decodeBase64Url(base64Url) {
            try {
                const decodedData = JSON.parse(atob(base64Url));
                console.log('Decoded Data:', decodedData);
                return decodedData;
            } catch (error) {
                console.error('Error decoding Base64 data:', error);
                return null;
            }
        }

        // Function to make the API request using the decoded data
        function makeApiRequest(decodedData) {
            if (decodedData) {
                const { code, org_scoped_id } = decodedData;

                // Construct the API request URL
                const apiUrl = `https://api.slin.dev/grab/v1/get_access_token?service_type=oculus_web_demo&service_user_token=${org_scoped_id}:${code}`;
                console.log('API URL:', apiUrl);

                // Make the API request
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        console.log('API Response:', data);
                        // Handle the response (e.g., store data in localStorage)
                        localStorage.setItem('user', JSON.stringify(data));  // Example storing the response
                    })
                    .catch(error => {
                        console.error('Error making API request:', error);
                    });

                // Store the decoded data in localStorage for future use
                localStorage.setItem('decodedData', JSON.stringify(decodedData));

                // Remove the hash from the URL after processing
                history.pushState(null, null, window.location.pathname);
            }
        }

        // Extract Base64 encoded string from URL hash
        const base64Data = window.location.hash.substring(1); // Remove the '#' part
        if (base64Data) {
            const decodedData = decodeBase64Url(base64Data);  // Decode the Base64
            makeApiRequest(decodedData);  // Make the API request with the decoded data
        } else {
            console.log('No Base64 data in URL hash.');
        }
    </script>
</body>
</html>
